"use strict";(self.webpackChunksmartpad_docs=self.webpackChunksmartpad_docs||[]).push([[314],{4783(e,n,s){s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"specs/currency-and-fx","title":"Currency and FX","description":"Covers currency units, FX conversion, manual overrides, and formatting rules for money calculations.","source":"@site/docs/specs/currency-and-fx.md","sourceDirName":"specs","slug":"/specs/currency-and-fx","permalink":"/docs/specs/currency-and-fx","draft":false,"unlisted":false,"editUrl":"https://github.com/nmaxcom/SmartPad/tree/main/website/docs/specs/currency-and-fx.md","tags":[],"version":"current","frontMatter":{"title":"Currency and FX","description":"Covers currency units, FX conversion, manual overrides, and formatting rules for money calculations."},"sidebar":"docsSidebar","previous":{"title":"Plotting and Dependency Views","permalink":"/docs/specs/plotting-and-dependency-views"},"next":{"title":"Duration and Time Values","permalink":"/docs/specs/duration-and-time-values"}}');var i=s(4848),l=s(8453);const c={title:"Currency and FX",description:"Covers currency units, FX conversion, manual overrides, and formatting rules for money calculations."},a=void 0,t={},d=[{value:"At a glance",id:"at-a-glance",level:2},{value:"Quick examples",id:"quick-examples",level:2},{value:"Happy path",id:"happy-path",level:3},{value:"What this covers",id:"what-this-covers",level:2},{value:"Full specification",id:"full-specification",level:2},{value:"0) Goals",id:"0-goals",level:2},{value:"1) Currency units and symbols",id:"1-currency-units-and-symbols",level:2},{value:"2) Conversion syntax (must use <code>to</code> / <code>in</code>)",id:"2-conversion-syntax-must-use-to--in",level:2},{value:"3) FX conversion behavior",id:"3-fx-conversion-behavior",level:2},{value:"3.1 When FX is needed",id:"31-when-fx-is-needed",level:3},{value:"3.2 Live FX sources (priority order)",id:"32-live-fx-sources-priority-order",level:3},{value:"3.3 Live rate usage",id:"33-live-rate-usage",level:3},{value:"4) Manual FX overrides (take precedence)",id:"4-manual-fx-overrides-take-precedence",level:2},{value:"5) Currency with units (rates)",id:"5-currency-with-units-rates",level:2},{value:"6) Formatting and display",id:"6-formatting-and-display",level:2},{value:"7) Settings indicator (status + provider)",id:"7-settings-indicator-status--provider",level:2},{value:"8) Regular user examples (syntax)",id:"8-regular-user-examples-syntax",level:2},{value:"Travel",id:"travel",level:3},{value:"Shopping",id:"shopping",level:3},{value:"Salary + rates",id:"salary--rates",level:3},{value:"Manual override (fixed trip rate)",id:"manual-override-fixed-trip-rate",level:3},{value:"Mixed currency plan",id:"mixed-currency-plan",level:3},{value:"9) Edge cases and guardrails",id:"9-edge-cases-and-guardrails",level:2},{value:"10) Implementation notes (fit with current code)",id:"10-implementation-notes-fit-with-current-code",level:2}];function o(e){const n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Source: ",(0,i.jsx)(n.code,{children:"docs/Specs/Currency.spec.md"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"at-a-glance",children:"At a glance"}),"\n",(0,i.jsx)(n.p,{children:"Covers currency units, FX conversion, manual overrides, and formatting rules for money calculations."}),"\n",(0,i.jsx)(n.h2,{id:"quick-examples",children:"Quick examples"}),"\n",(0,i.jsx)(n.h3,{id:"happy-path",children:"Happy path"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-smartpad",children:"price = $19.99\nprice in EUR => EUR 18.42\n\nrate = CAD 120\nrate in USD => $88.35\n\nbtc = BTC 0.015\nbtc in USD => $937.42\n"})}),"\n",(0,i.jsx)(n.h2,{id:"what-this-covers",children:"What this covers"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.ol,{start:"0",children:["\n",(0,i.jsx)(n.li,{children:"Goals"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Currency units and symbols"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:["Conversion syntax (must use ",(0,i.jsx)(n.code,{children:"to"})," / ",(0,i.jsx)(n.code,{children:"in"}),")"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"FX conversion behavior"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:"Manual FX overrides (take precedence)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsx)(n.li,{children:"Currency with units (rates)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.ol,{start:"6",children:["\n",(0,i.jsx)(n.li,{children:"Formatting and display"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.ol,{start:"7",children:["\n",(0,i.jsx)(n.li,{children:"Settings indicator (status + provider)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.ol,{start:"8",children:["\n",(0,i.jsx)(n.li,{children:"Regular user examples (syntax)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.ol,{start:"9",children:["\n",(0,i.jsx)(n.li,{children:"Edge cases and guardrails"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"full-specification",children:"Full specification"}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"Open full spec: SmartPad Currency + FX Spec"}),(0,i.jsxs)(n.p,{children:["This spec defines currency as a first-class unit, how FX conversion works, and how manual rate overrides interact with live data. It is written to fit SmartPad's existing unit math and ",(0,i.jsx)(n.code,{children:"to"}),"/",(0,i.jsx)(n.code,{children:"in"})," conversion rules."]}),(0,i.jsx)(n.hr,{}),(0,i.jsx)(n.h2,{id:"0-goals",children:"0) Goals"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Treat currency like any other unit dimension (it can combine with other units)."}),"\n",(0,i.jsxs)(n.li,{children:["Allow inline conversions with ",(0,i.jsx)(n.code,{children:"to"})," / ",(0,i.jsx)(n.code,{children:"in"})," (no new syntax, no @ directives)."]}),"\n",(0,i.jsx)(n.li,{children:"Use live FX rates by default, with Frankfurter as primary and ECB as backup."}),"\n",(0,i.jsx)(n.li,{children:"If the user declares a manual rate, ignore live FX for that pair."}),"\n",(0,i.jsx)(n.li,{children:"Keep outputs readable and consistent with existing formatting."}),"\n"]}),(0,i.jsx)(n.hr,{}),(0,i.jsx)(n.h2,{id:"1-currency-units-and-symbols",children:"1) Currency units and symbols"}),(0,i.jsx)(n.p,{children:"SmartPad supports currency in two interchangeable forms:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Symbol form (existing): dollar sign, euro sign, pound sign, yen sign, rupee sign, bitcoin sign, plus suffix symbols ",(0,i.jsx)(n.code,{children:"CHF"}),", ",(0,i.jsx)(n.code,{children:"CAD"}),", ",(0,i.jsx)(n.code,{children:"AUD"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["ISO code form (new for FX): ",(0,i.jsx)(n.code,{children:"USD"}),", ",(0,i.jsx)(n.code,{children:"EUR"}),", ",(0,i.jsx)(n.code,{children:"GBP"}),", ",(0,i.jsx)(n.code,{children:"JPY"}),", ",(0,i.jsx)(n.code,{children:"INR"}),", ",(0,i.jsx)(n.code,{children:"BTC"}),", ",(0,i.jsx)(n.code,{children:"CHF"}),", ",(0,i.jsx)(n.code,{children:"CAD"}),", ",(0,i.jsx)(n.code,{children:"AUD"}),"."]}),"\n"]}),(0,i.jsx)(n.p,{children:"Mapping rules (display + parsing):"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$"})," is ",(0,i.jsx)(n.code,{children:"USD"}),". Euro sign is ",(0,i.jsx)(n.code,{children:"EUR"}),", pound sign is ",(0,i.jsx)(n.code,{children:"GBP"}),", yen sign is ",(0,i.jsx)(n.code,{children:"JPY"}),", rupee sign is ",(0,i.jsx)(n.code,{children:"INR"}),", bitcoin sign is ",(0,i.jsx)(n.code,{children:"BTC"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Other ISO codes may render with their familiar symbols in the UI, but the code form is always valid."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CHF"}),", ",(0,i.jsx)(n.code,{children:"CAD"}),", ",(0,i.jsx)(n.code,{children:"AUD"})," display as suffix (e.g., ",(0,i.jsx)(n.code,{children:"100 CHF"}),")."]}),"\n",(0,i.jsx)(n.li,{children:"Symbols remain the default display unless the user explicitly targets a code."}),"\n"]}),(0,i.jsx)(n.p,{children:"Examples:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"price = $19.99\nprice in EUR => EUR 18.42\n\nrate = CAD 120\nrate in USD => $88.35\n\nbtc = BTC 0.015\nbtc in USD => $937.42\n"})}),(0,i.jsx)(n.hr,{}),(0,i.jsxs)(n.h2,{id:"2-conversion-syntax-must-use-to--in",children:["2) Conversion syntax (must use ",(0,i.jsx)(n.code,{children:"to"})," / ",(0,i.jsx)(n.code,{children:"in"}),")"]}),(0,i.jsx)(n.p,{children:"Currency conversion uses the existing conversion suffix:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"$120 in EUR\nEUR 50 to USD\nCAD 300 in GBP\n"})}),(0,i.jsx)(n.p,{children:"Rules:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"to"})," / ",(0,i.jsx)(n.code,{children:"in"})," bind last and weakest, as defined in ",(0,i.jsx)(n.code,{children:"Unit.spec.md"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"to"})," / ",(0,i.jsx)(n.code,{children:"in"})," only trigger when the right-hand side parses as a valid unit target."]}),"\n",(0,i.jsxs)(n.li,{children:["No ",(0,i.jsx)(n.code,{children:"->"})," conversion syntax (not supported)."]}),"\n"]}),(0,i.jsx)(n.hr,{}),(0,i.jsx)(n.h2,{id:"3-fx-conversion-behavior",children:"3) FX conversion behavior"}),(0,i.jsx)(n.h3,{id:"31-when-fx-is-needed",children:"3.1 When FX is needed"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Same-currency math works as today."}),"\n",(0,i.jsx)(n.li,{children:"Cross-currency conversion requires an FX rate."}),"\n"]}),(0,i.jsx)(n.h3,{id:"32-live-fx-sources-priority-order",children:"3.2 Live FX sources (priority order)"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Frankfurter (primary)"}),"\n",(0,i.jsx)(n.li,{children:"ECB (fallback, seamless)"}),"\n"]}),(0,i.jsx)(n.p,{children:"Frankfurter uses ECB rates, but we still treat ECB as a separate fallback for resilience."}),(0,i.jsx)(n.h3,{id:"33-live-rate-usage",children:"3.3 Live rate usage"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use the most recent available rate from the active provider."}),"\n",(0,i.jsx)(n.li,{children:"Cache rates locally and reuse until stale (daily cadence is acceptable)."}),"\n",(0,i.jsx)(n.li,{children:"If live rates are unavailable, show a clear error (unless manual overrides exist)."}),"\n"]}),(0,i.jsx)(n.hr,{}),(0,i.jsx)(n.h2,{id:"4-manual-fx-overrides-take-precedence",children:"4) Manual FX overrides (take precedence)"}),(0,i.jsx)(n.p,{children:"If the user declares a rate in the document, use it instead of live FX for that pair."}),(0,i.jsx)(n.p,{children:"Manual rates are declared with normal assignments. Since currency codes are valid currency literals, a manual rate can be written as:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"EUR = 1.08 USD\nGBP = 1.26 USD\nJPY = 0.0067 USD\n"})}),(0,i.jsx)(n.p,{children:"That means:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"$100 in EUR => EUR 92.59\nGBP 50 in USD => $63.00\n"})}),(0,i.jsx)(n.p,{children:"Rules:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Manual rates override live FX for the matching pair."}),"\n",(0,i.jsx)(n.li,{children:"If both directions are declared, use the direct one."}),"\n",(0,i.jsx)(n.li,{children:"If only one direction is declared, the inverse is derived."}),"\n",(0,i.jsx)(n.li,{children:"Scope and precedence follow normal SmartPad variable rules (nearest wins)."}),"\n"]}),(0,i.jsx)(n.hr,{}),(0,i.jsx)(n.h2,{id:"5-currency-with-units-rates",children:"5) Currency with units (rates)"}),(0,i.jsx)(n.p,{children:"Currency values can combine with other units as today, and FX should only affect the currency portion."}),(0,i.jsx)(n.p,{children:"Examples:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"hourly = $85/hour\nhourly in EUR/hour => EUR 78.30/hour\n\nfuel = EUR 1.89/liter\nfuel in USD/liter => $2.05/liter\n"})}),(0,i.jsx)(n.hr,{}),(0,i.jsx)(n.h2,{id:"6-formatting-and-display",children:"6) Formatting and display"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use SmartPad's existing number formatting rules (commas, decimals, scientific thresholds)."}),"\n",(0,i.jsx)(n.li,{children:"Default display uses symbols unless the user targets a code."}),"\n",(0,i.jsx)(n.li,{children:"Preserve the user's requested unit target in output."}),"\n"]}),(0,i.jsx)(n.p,{children:"Examples:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"EUR 1200 in USD => $1,301.40\nCAD 1000 to EUR => EUR 684.72\n"})}),(0,i.jsx)(n.hr,{}),(0,i.jsx)(n.h2,{id:"7-settings-indicator-status--provider",children:"7) Settings indicator (status + provider)"}),(0,i.jsx)(n.p,{children:"Add a small, friendly indicator in Settings > Currency that shows which FX source is currently active."}),(0,i.jsx)(n.p,{children:"Example UI copy (text-only mock):"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Live FX: Frankfurter  [active] (updated 3h ago)\nBackup: ECB           [standby]\n"})}),(0,i.jsx)(n.p,{children:"Behavior:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Green status when Frankfurter is active."}),"\n",(0,i.jsx)(n.li,{children:"Amber status when ECB is active (fallback)."}),"\n",(0,i.jsx)(n.li,{children:"Gray status when offline or rates are stale."}),"\n",(0,i.jsx)(n.li,{children:"Tooltip or subtitle shows last successful update time."}),"\n"]}),(0,i.jsx)(n.hr,{}),(0,i.jsx)(n.h2,{id:"8-regular-user-examples-syntax",children:"8) Regular user examples (syntax)"}),(0,i.jsx)(n.h3,{id:"travel",children:"Travel"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"hotel = EUR 240\nhotel in USD => $260.30\n\nbudget = $1,500\nbudget in EUR => EUR 1,384.20\n"})}),(0,i.jsx)(n.h3,{id:"shopping",children:"Shopping"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"price = GBP 79\nprice in USD => $99.50\n\nshipping = $12\nshipping in GBP => GBP 9.55\n"})}),(0,i.jsx)(n.h3,{id:"salary--rates",children:"Salary + rates"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"hourly = $85/hour\nmonthly hours = 168 h\npay = hourly * monthly hours => $14,280\npay in EUR => EUR 13,150\n"})}),(0,i.jsx)(n.h3,{id:"manual-override-fixed-trip-rate",children:"Manual override (fixed trip rate)"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"EUR = 1.10 USD\nmeal = EUR 18\nmeal in USD => $19.80\n"})}),(0,i.jsx)(n.h3,{id:"mixed-currency-plan",children:"Mixed currency plan"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"subscription = CAD 15/month\nsubscription in USD/month => $11.05/month\n"})}),(0,i.jsx)(n.hr,{}),(0,i.jsx)(n.h2,{id:"9-edge-cases-and-guardrails",children:"9) Edge cases and guardrails"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Unknown currency code => error with suggestion."}),"\n",(0,i.jsx)(n.li,{children:"Conversion requested with no live rate and no manual rate => error."}),"\n",(0,i.jsx)(n.li,{children:"Cryptocurrency support is manual-first unless the provider offers the pair."}),"\n",(0,i.jsx)(n.li,{children:"Rates must be positive finite numbers."}),"\n"]}),(0,i.jsx)(n.hr,{}),(0,i.jsx)(n.h2,{id:"10-implementation-notes-fit-with-current-code",children:"10) Implementation notes (fit with current code)"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Currency remains a first-class type (",(0,i.jsx)(n.code,{children:"CurrencyValue"}),", ",(0,i.jsx)(n.code,{children:"CurrencyUnitValue"}),")."]}),"\n",(0,i.jsx)(n.li,{children:"ISO codes are treated as built-in currency tokens that render as suffixes by default."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"to"})," / ",(0,i.jsx)(n.code,{children:"in"})," conversion should detect currency targets and route through FX conversion logic."]}),"\n",(0,i.jsx)(n.li,{children:"Manual rate declarations are detected when a currency code variable is assigned a value in a different currency."}),"\n"]})]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453(e,n,s){s.d(n,{R:()=>c,x:()=>a});var r=s(6540);const i={},l=r.createContext(i);function c(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);