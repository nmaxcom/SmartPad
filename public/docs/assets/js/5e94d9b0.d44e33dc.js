"use strict";(self.webpackChunksmartpad_docs=self.webpackChunksmartpad_docs||[]).push([[153],{1686(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"specs/locale","title":"SmartPad Date/Time Ranges & Display Spec (Locale-aware, Opinionated, With Tests)","description":"This spec resolves current failures and confusion around:","source":"@site/docs/specs/locale.md","sourceDirName":"specs","slug":"/specs/locale","permalink":"/SmartPad/docs/specs/locale","draft":false,"unlisted":false,"editUrl":"https://github.com/nmaxcom/SmartPad/tree/main/website/docs/specs/locale.md","tags":[],"version":"current","frontMatter":{"title":"SmartPad Date/Time Ranges & Display Spec (Locale-aware, Opinionated, With Tests)","description":"This spec resolves current failures and confusion around:"}}');var i=s(4848),a=s(8453);const r={title:"SmartPad Date/Time Ranges & Display Spec (Locale-aware, Opinionated, With Tests)",description:"This spec resolves current failures and confusion around:"},l=void 0,d={},o=[{value:"1) Range Expression Routing (must happen before date-math and solver)",id:"1-range-expression-routing-must-happen-before-date-math-and-solver",level:2},{value:"Requirement",id:"requirement",level:3},{value:"Rationale",id:"rationale",level:3},{value:"Behavior",id:"behavior",level:3},{value:"Tests (routing)",id:"tests-routing",level:3},{value:"2) Range Grammar (natural \u201cstep\u201d suffix, not named args)",id:"2-range-grammar-natural-step-suffix-not-named-args",level:2},{value:"Syntax",id:"syntax",level:3},{value:"Step value types",id:"step-value-types",level:3},{value:"Tests (grammar)",id:"tests-grammar",level:3},{value:"3) Locale-Aware Date/Datetime Input Parsing (es-ES)",id:"3-locale-aware-datedatetime-input-parsing-es-es",level:2},{value:"Requirement",id:"requirement-1",level:3},{value:"Canonical internal representation",id:"canonical-internal-representation",level:3},{value:"Accepted literals for es-ES",id:"accepted-literals-for-es-es",level:3},{value:"Date literal (es-ES)",id:"date-literal-es-es",level:4},{value:"Datetime literal (es-ES)",id:"datetime-literal-es-es",level:4},{value:"Disambiguation policy (opinionated)",id:"disambiguation-policy-opinionated",level:3},{value:"Tests (es-ES parsing)",id:"tests-es-es-parsing",level:3},{value:"Invalid locale date should be a targeted error (not solver)",id:"invalid-locale-date-should-be-a-targeted-error-not-solver",level:3},{value:"4) Date/Time/Datetime Range Semantics",id:"4-datetimedatetime-range-semantics",level:2},{value:"Step requirement (opinionated)",id:"step-requirement-opinionated",level:3},{value:"Tests (missing step)",id:"tests-missing-step",level:4},{value:"Invalid step types",id:"invalid-step-types",level:3},{value:"Inclusivity rule",id:"inclusivity-rule",level:3},{value:"Tests",id:"tests",level:4},{value:"Weekly stepping preserves weekday",id:"weekly-stepping-preserves-weekday",level:3},{value:"Test",id:"test",level:4},{value:"Monthly stepping: \u201csame day-of-month\u201d rule with anchor",id:"monthly-stepping-same-day-of-month-rule-with-anchor",level:3},{value:"Test (same day-of-month)",id:"test-same-day-of-month",level:4},{value:"Month-end stepping: clamp-to-last-day semantics (anchored)",id:"month-end-stepping-clamp-to-last-day-semantics-anchored",level:3},{value:"Test (critical)",id:"test-critical",level:4},{value:"5) Guardrails (must be a user setting)",id:"5-guardrails-must-be-a-user-setting",level:2},{value:"Setting",id:"setting",level:3},{value:"Behavior",id:"behavior-1",level:3},{value:"Tests",id:"tests-1",level:3},{value:"6) Error Normalization (no raw parser leaks for <code>..</code>)",id:"6-error-normalization-no-raw-parser-leaks-for-",level:2},{value:"Requirement",id:"requirement-2",level:3},{value:"Tests (normalization)",id:"tests-normalization",level:3},{value:"7) Output Formatting (Timezone label + compact display)",id:"7-output-formatting-timezone-label--compact-display",level:2},{value:"7.1 No \u201clocal\u201d in user-facing datetime output when locale/timezone is configured",id:"71-no-local-in-user-facing-datetime-output-when-localetimezone-is-configured",level:3},{value:"Tests (timezone label)",id:"tests-timezone-label",level:3},{value:"7.2 Compact list display: suppress repeating identical dates in datetime lists",id:"72-compact-list-display-suppress-repeating-identical-dates-in-datetime-lists",level:3},{value:"Example output format (recommended)",id:"example-output-format-recommended",level:4},{value:"Tests (compact display)",id:"tests-compact-display",level:3},{value:"7.3 \u201c=&gt;\u201d display vs assignment-only behavior (must match SmartPad core concept)",id:"73--display-vs-assignment-only-behavior-must-match-smartpad-core-concept",level:3},{value:"Tests",id:"tests-2",level:4},{value:"8) Reference Test Set (focused on the reported failures)",id:"8-reference-test-set-focused-on-the-reported-failures",level:2},{value:"Missing step",id:"missing-step",level:3},{value:"Month-end clamp",id:"month-end-clamp",level:3},{value:"Time slots (assignment line returns null; value exists)",id:"time-slots-assignment-line-returns-null-value-exists",level:3},{value:"Guardrail",id:"guardrail",level:3},{value:"Non-duration step",id:"non-duration-step",level:3},{value:"es-ES date input must not route to solver",id:"es-es-date-input-must-not-route-to-solver",level:3}];function c(e){const n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Source: ",(0,i.jsx)(n.code,{children:"docs/Specs/Locale.spec.md"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This spec resolves current failures and confusion around:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["locale-aware date parsing (",(0,i.jsx)(n.code,{children:"es-ES"})," inputs like ",(0,i.jsx)(n.code,{children:"01-02-2023"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"routing range expressions before date-math/solver parsing"}),"\n",(0,i.jsx)(n.li,{children:"correct stepping (including month-end clamping)"}),"\n",(0,i.jsx)(n.li,{children:"guardrails and user-facing error normalization"}),"\n",(0,i.jsx)(n.li,{children:"output formatting (timezone label, compact display without repeating identical dates)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["SmartPad philosophy: ",(0,i.jsx)(n.strong,{children:"natural input, predictable meaning, honest errors, and readable output."}),"\nIf a user can reasonably type it, SmartPad should either understand it or give a targeted correction\u2014not a solver/equation error."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"1-range-expression-routing-must-happen-before-date-math-and-solver",children:"1) Range Expression Routing (must happen before date-math and solver)"}),"\n",(0,i.jsx)(n.h3,{id:"requirement",children:"Requirement"}),"\n",(0,i.jsxs)(n.p,{children:["Any expression containing ",(0,i.jsx)(n.code,{children:".."})," must be treated as a ",(0,i.jsx)(n.strong,{children:"range candidate"})," and parsed using the range parser/evaluator ",(0,i.jsx)(n.strong,{children:"before"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"dateMath/date-expression parsing"}),"\n",(0,i.jsx)(n.li,{children:"solver/equation parsing"}),"\n",(0,i.jsx)(n.li,{children:"generic \u201cnamed argument\u201d parsing"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"rationale",children:"Rationale"}),"\n",(0,i.jsx)(n.p,{children:"Range syntax is a top-level construct in SmartPad (\u201cdo the same reasoning, but plural\u201d). It should not be accidentally swallowed by other parsers."}),"\n",(0,i.jsx)(n.h3,{id:"behavior",children:"Behavior"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"If range parsing succeeds \u2192 evaluate range and return list (or set variable)."}),"\n",(0,i.jsxs)(n.li,{children:["If range parsing fails \u2192 surface a ",(0,i.jsx)(n.strong,{children:"range-specific error"}),", not a date-math or solver error."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tests-routing",children:"Tests (routing)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"period = 2026-01-01..2026-01-05 =>\u26a0\ufe0f Date/time ranges require a duration step (e.g., step 1 day)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Must ",(0,i.jsx)(n.strong,{children:"not"})," produce:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'\u26a0\ufe0f Invalid date expression near "..2026-01-05"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"slots = 01-02-2023 09:00..14-02-2023 11:00 step 64 min =>\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Must ",(0,i.jsx)(n.strong,{children:"not"})," produce:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"\u26a0\ufe0f Cannot solve: equation is not valid\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-range-grammar-natural-step-suffix-not-named-args",children:"2) Range Grammar (natural \u201cstep\u201d suffix, not named args)"}),"\n",(0,i.jsx)(n.h3,{id:"syntax",children:"Syntax"}),"\n",(0,i.jsx)(n.p,{children:"A range expression is:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"<start>..<end>\n<start>..<end> step <stepValue>\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Where ",(0,i.jsx)(n.code,{children:"step"})," is a ",(0,i.jsx)(n.strong,{children:"keyword suffix"})," in range grammar, not a named argument."]}),"\n",(0,i.jsx)(n.h3,{id:"step-value-types",children:"Step value types"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Numeric ranges: step must be an integer number (unitless)"}),"\n",(0,i.jsxs)(n.li,{children:["Date/Time/Datetime ranges: step must be a duration (e.g., ",(0,i.jsx)(n.code,{children:"30 min"}),", ",(0,i.jsx)(n.code,{children:"1 day"}),", ",(0,i.jsx)(n.code,{children:"2 weeks"}),", ",(0,i.jsx)(n.code,{children:"1 month"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tests-grammar",children:"Tests (grammar)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"1..5 =>1, 2, 3, 4, 5\n0..10 step 2 =>0, 2, 4, 6, 8, 10\n09:00..11:00 step 30 min =>09:00, 09:30, 10:00, 10:30, 11:00\n2026-01-01..2026-01-05 step 1 day =>2026-01-01, 2026-01-02, 2026-01-03, 2026-01-04, 2026-01-05\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"3-locale-aware-datedatetime-input-parsing-es-es",children:"3) Locale-Aware Date/Datetime Input Parsing (es-ES)"}),"\n",(0,i.jsx)(n.h3,{id:"requirement-1",children:"Requirement"}),"\n",(0,i.jsxs)(n.p,{children:["SmartPad must accept locale-friendly date formats for input when the user has configured a locale. For ",(0,i.jsx)(n.code,{children:"es-ES"}),", accept:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"DD-MM-YYYY"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DD/MM/YYYY"})," (optional but recommended)"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["These must be tokenized as ",(0,i.jsx)(n.code,{children:"DATE_LITERAL"}),", not as arithmetic with ",(0,i.jsx)(n.code,{children:"-"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"canonical-internal-representation",children:"Canonical internal representation"}),"\n",(0,i.jsx)(n.p,{children:"Regardless of input format, internal values are normalized to ISO:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["date: ",(0,i.jsx)(n.code,{children:"YYYY-MM-DD"})]}),"\n",(0,i.jsxs)(n.li,{children:["time: ",(0,i.jsx)(n.code,{children:"HH:MM"})]}),"\n",(0,i.jsx)(n.li,{children:"datetime: ISO + timezone-aware instant"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"accepted-literals-for-es-es",children:"Accepted literals for es-ES"}),"\n",(0,i.jsx)(n.h4,{id:"date-literal-es-es",children:"Date literal (es-ES)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"01-02-2023"})," = 1 Feb 2023"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"14/02/2023"})," = 14 Feb 2023"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"datetime-literal-es-es",children:"Datetime literal (es-ES)"}),"\n",(0,i.jsxs)(n.p,{children:["A datetime literal is ",(0,i.jsx)(n.code,{children:"DATE_LITERAL"})," + space + ",(0,i.jsx)(n.code,{children:"TIME_LITERAL"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"01-02-2023 09:00"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"14/02/2023 11:00"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"disambiguation-policy-opinionated",children:"Disambiguation policy (opinionated)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["In ",(0,i.jsx)(n.code,{children:"es-ES"}),", ",(0,i.jsx)(n.code,{children:"DD-MM-YYYY"})," is not ambiguous \u2192 always interpret as day-month-year."]}),"\n",(0,i.jsx)(n.li,{children:"If the locale is unknown/unset, only ISO is accepted as input."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tests-es-es-parsing",children:"Tests (es-ES parsing)"}),"\n",(0,i.jsxs)(n.p,{children:["Assume context locale = ",(0,i.jsx)(n.code,{children:"es-ES"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"d = 01-02-2023\nd =>2023-02-01\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"t = 09:30\nt =>09:30\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"dt = 01-02-2023 09:30\ndt =>2023-02-01 09:30 Europe/Madrid (UTC+1)\n"})}),"\n",(0,i.jsx)(n.p,{children:"Range with es-ES dates:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"slots = 01-02-2023 09:00..14-02-2023 11:00 step 64 min =>\n"})}),"\n",(0,i.jsx)(n.p,{children:"Must not error as solver/dateMath; must produce a datetime list (guardrail permitting)."}),"\n",(0,i.jsx)(n.h3,{id:"invalid-locale-date-should-be-a-targeted-error-not-solver",children:"Invalid locale date should be a targeted error (not solver)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'d = 32-02-2023 =>\u26a0\ufe0f Invalid date literal "32-02-2023"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["If locale is unset and user uses ",(0,i.jsx)(n.code,{children:"DD-MM-YYYY"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'d = 01-02-2023 =>\u26a0\ufe0f Unsupported date format "01-02-2023". Use ISO "2023-02-01".\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"4-datetimedatetime-range-semantics",children:"4) Date/Time/Datetime Range Semantics"}),"\n",(0,i.jsx)(n.h3,{id:"step-requirement-opinionated",children:"Step requirement (opinionated)"}),"\n",(0,i.jsxs)(n.p,{children:["For ",(0,i.jsx)(n.code,{children:"date"}),", ",(0,i.jsx)(n.code,{children:"time"}),", and ",(0,i.jsx)(n.code,{children:"datetime"})," ranges: ",(0,i.jsx)(n.strong,{children:"step is required"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"This avoids \u201csilent assumptions\u201d and keeps user intent explicit."}),"\n",(0,i.jsx)(n.h4,{id:"tests-missing-step",children:"Tests (missing step)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"period = 2026-01-01..2026-01-05 =>\u26a0\ufe0f Date/time ranges require a duration step (e.g., step 1 day)\nslots = 09:00..11:00 =>\u26a0\ufe0f Date/time ranges require a duration step (e.g., step 30 min)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"invalid-step-types",children:"Invalid step types"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"period = 2026-01-01..2026-01-05 step 2 =>\u26a0\ufe0f Invalid range step: expected duration, got number\nxs = 1..10 step 1 day =>\u26a0\ufe0f Invalid range step: expected integer, got duration\n"})}),"\n",(0,i.jsx)(n.h3,{id:"inclusivity-rule",children:"Inclusivity rule"}),"\n",(0,i.jsx)(n.p,{children:"A range includes the end value only if it aligns exactly on the step sequence."}),"\n",(0,i.jsx)(n.h4,{id:"tests",children:"Tests"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"09:00..10:00 step 30 min =>09:00, 09:30, 10:00\n09:00..10:00 step 40 min =>09:00, 09:40\n"})}),"\n",(0,i.jsx)(n.h3,{id:"weekly-stepping-preserves-weekday",children:"Weekly stepping preserves weekday"}),"\n",(0,i.jsx)(n.h4,{id:"test",children:"Test"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"2026-01-01..2026-02-01 step 1 week =>2026-01-01, 2026-01-08, 2026-01-15, 2026-01-22, 2026-01-29\n"})}),"\n",(0,i.jsx)(n.h3,{id:"monthly-stepping-same-day-of-month-rule-with-anchor",children:"Monthly stepping: \u201csame day-of-month\u201d rule with anchor"}),"\n",(0,i.jsxs)(n.p,{children:["Monthly stepping must use the ",(0,i.jsx)(n.strong,{children:"original start day-of-month"})," as the anchor, not the previously emitted date\u2019s day."]}),"\n",(0,i.jsx)(n.h4,{id:"test-same-day-of-month",children:"Test (same day-of-month)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"2026-01-15..2026-05-15 step 1 month =>2026-01-15, 2026-02-15, 2026-03-15, 2026-04-15, 2026-05-15\n"})}),"\n",(0,i.jsx)(n.h3,{id:"month-end-stepping-clamp-to-last-day-semantics-anchored",children:"Month-end stepping: clamp-to-last-day semantics (anchored)"}),"\n",(0,i.jsxs)(n.p,{children:["If the anchor day doesn\u2019t exist in a target month, clamp to the last day of that month ",(0,i.jsx)(n.strong,{children:"but keep the original anchor for subsequent months"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"test-critical",children:"Test (critical)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"2026-01-31..2026-05-31 step 1 month =>2026-01-31, 2026-02-28, 2026-03-31, 2026-04-30, 2026-05-31\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"5-guardrails-must-be-a-user-setting",children:"5) Guardrails (must be a user setting)"}),"\n",(0,i.jsx)(n.h3,{id:"setting",children:"Setting"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Name (suggested): ",(0,i.jsx)(n.code,{children:"max generated list size"})]}),"\n",(0,i.jsxs)(n.li,{children:["Default (suggested): ",(0,i.jsx)(n.code,{children:"10000"})]}),"\n",(0,i.jsx)(n.li,{children:"Applies to all generated ranges (numeric/date/time/datetime)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"behavior-1",children:"Behavior"}),"\n",(0,i.jsx)(n.p,{children:"After parsing and validating step, compute number of elements.\nIf exceeds setting, error:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"\u26a0\ufe0f Range too large (<n> elements; max <max>)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"tests-1",children:"Tests"}),"\n",(0,i.jsxs)(n.p,{children:["Assume setting ",(0,i.jsx)(n.code,{children:"max generated list size = 500"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"slots = 2026-01-01 09:00..2026-01-01 23:59 step 1 min =>\n\u26a0\ufe0f Range too large (900 elements; max 500)\n"})}),"\n",(0,i.jsx)(n.p,{children:"Guardrail must not be shadowed by date-math parser errors."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"6-error-normalization-no-raw-parser-leaks-for-",children:["6) Error Normalization (no raw parser leaks for ",(0,i.jsx)(n.code,{children:".."}),")"]}),"\n",(0,i.jsx)(n.h3,{id:"requirement-2",children:"Requirement"}),"\n",(0,i.jsxs)(n.p,{children:["If an input contains ",(0,i.jsx)(n.code,{children:".."}),", SmartPad must never surface:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"raw dateMath \u201cInvalid date expression near \u2026\u201d"}),"\n",(0,i.jsx)(n.li,{children:"raw parser \u201cInvalid named argument \u2026\u201d"}),"\n",(0,i.jsx)(n.li,{children:"solver \u201cCannot solve \u2026\u201d"}),"\n",(0,i.jsx)(n.li,{children:"any unrelated internal parse errors"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Instead, errors must be normalized to one of:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Missing duration step (date/time/datetime):"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"\u26a0\ufe0f Date/time ranges require a duration step (e.g., step 1 day)\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Invalid step type:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"\u26a0\ufe0f Invalid range step: expected <expected>, got <got>\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Guardrail:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"\u26a0\ufe0f Range too large (<n> elements; max <max>)\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:"Generic malformed range:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'\u26a0\ufe0f Invalid range expression near "<snippet>"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"tests-normalization",children:"Tests (normalization)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:'2026-01-01....2026-01-05 =>\u26a0\ufe0f Invalid range expression near "2026-01-01....2026-01-05"\n2026-01-01.. step 1 day =>\u26a0\ufe0f Invalid range expression near "2026-01-01.. step 1 day"\n..2026-01-05 step 1 day =>\u26a0\ufe0f Invalid range expression near "..2026-01-05 step 1 day"\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"7-output-formatting-timezone-label--compact-display",children:"7) Output Formatting (Timezone label + compact display)"}),"\n",(0,i.jsx)(n.h3,{id:"71-no-local-in-user-facing-datetime-output-when-localetimezone-is-configured",children:"7.1 No \u201clocal\u201d in user-facing datetime output when locale/timezone is configured"}),"\n",(0,i.jsxs)(n.p,{children:["If the user has configured locale/timezone (e.g., ",(0,i.jsx)(n.code,{children:"es-ES"}),", ",(0,i.jsx)(n.code,{children:"Europe/Madrid"}),"), never print \u201clocal\u201d.\nUse one of:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Europe/Madrid (UTC+1)"})," (recommended)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"UTC+1"})," (acceptable minimal)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Europe/Madrid"})," (acceptable)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tests-timezone-label",children:"Tests (timezone label)"}),"\n",(0,i.jsxs)(n.p,{children:["Assume timezone ",(0,i.jsx)(n.code,{children:"Europe/Madrid"}),", date in winter:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"dt = 2026-01-01 09:00\ndt =>2026-01-01 09:00 Europe/Madrid (UTC+1)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"72-compact-list-display-suppress-repeating-identical-dates-in-datetime-lists",children:"7.2 Compact list display: suppress repeating identical dates in datetime lists"}),"\n",(0,i.jsx)(n.p,{children:"When displaying a list of datetimes where multiple consecutive items share the same date, print the date once and then only times (with timezone) for subsequent items until the date changes."}),"\n",(0,i.jsx)(n.h4,{id:"example-output-format-recommended",children:"Example output format (recommended)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"slots =>2026-01-01: 09:00, 09:18, 09:36, 09:54, 10:12, 10:30, 10:48 Europe/Madrid (UTC+1)\n"})}),"\n",(0,i.jsx)(n.p,{children:"If the list spans multiple dates:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"slots =>2026-01-01: 23:30, 23:48 Europe/Madrid (UTC+1); 2026-01-02: 00:06, 00:24 Europe/Madrid (UTC+1)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"tests-compact-display",children:"Tests (compact display)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"slots = 2026-01-01 09:00..2026-01-01 11:00 step 18 min =>\nslots =>2026-01-01: 09:00, 09:18, 09:36, 09:54, 10:12, 10:30, 10:48 Europe/Madrid (UTC+1)\n"})}),"\n",(0,i.jsx)(n.p,{children:"Crossing midnight:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"slots = 2026-01-01 23:30..2026-01-02 00:30 step 18 min =>\nslots =>2026-01-01: 23:30, 23:48 Europe/Madrid (UTC+1); 2026-01-02: 00:06, 00:24 Europe/Madrid (UTC+1)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"73--display-vs-assignment-only-behavior-must-match-smartpad-core-concept",children:"7.3 \u201c=>\u201d display vs assignment-only behavior (must match SmartPad core concept)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Lines without ",(0,i.jsx)(n.code,{children:"=>"})," assign silently (return null)"]}),"\n",(0,i.jsxs)(n.li,{children:["Lines with ",(0,i.jsx)(n.code,{children:"=>"})," produce display output"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"tests-2",children:"Tests"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"slots = 2026-01-01 09:00..2026-01-01 11:00 step 30 min\n=> (no output; evaluateLine returns null; variable is set)\n\nslots =>2026-01-01: 09:00, 09:30, 10:00, 10:30, 11:00 Europe/Madrid (UTC+1)\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"8-reference-test-set-focused-on-the-reported-failures",children:"8) Reference Test Set (focused on the reported failures)"}),"\n",(0,i.jsxs)(n.p,{children:["These map to your failing ",(0,i.jsx)(n.code,{children:"dateRange.test.ts"})," cases:"]}),"\n",(0,i.jsx)(n.h3,{id:"missing-step",children:"Missing step"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"period = 2026-01-01..2026-01-05 =>\u26a0\ufe0f Date/time ranges require a duration step (e.g., step 1 day)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"month-end-clamp",children:"Month-end clamp"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"period = 2026-01-31..2026-05-31 step 1 month\nperiod =>2026-01-31, 2026-02-28, 2026-03-31, 2026-04-30, 2026-05-31\n"})}),"\n",(0,i.jsx)(n.h3,{id:"time-slots-assignment-line-returns-null-value-exists",children:"Time slots (assignment line returns null; value exists)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"slots = 2026-01-01 09:00..2026-01-01 11:00 step 30 min\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"slots =>2026-01-01: 09:00, 09:30, 10:00, 10:30, 11:00 Europe/Madrid (UTC+1)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"guardrail",children:"Guardrail"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"slots = 2026-01-01 09:00..2026-01-01 23:59 step 1 min =>\u26a0\ufe0f Range too large (900 elements; max 500)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"non-duration-step",children:"Non-duration step"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"period = 2026-01-01..2026-01-05 step 2 =>\u26a0\ufe0f Invalid range step: expected duration, got number\n"})}),"\n",(0,i.jsx)(n.h3,{id:"es-es-date-input-must-not-route-to-solver",children:"es-ES date input must not route to solver"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"slots = 01-02-2023 09:00..14-02-2023 11:00 step 64 min =>\n"})}),"\n",(0,i.jsx)(n.p,{children:"Must produce either:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"the computed list (if within guardrail)\nor:"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"\u26a0\ufe0f Range too large (...)"}),"\nbut never a solver error."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453(e,n,s){s.d(n,{R:()=>r,x:()=>l});var t=s(6540);const i={},a=t.createContext(i);function r(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);