"use strict";(self.webpackChunksmartpad_docs=self.webpackChunksmartpad_docs||[]).push([[33],{6412(e,s,n){n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"specs/locale-date-time","title":"Locale Date and Time","description":"Defines locale-aware date parsing, date/time ranges, output formatting, and error normalization.","source":"@site/docs/specs/locale-date-time.md","sourceDirName":"specs","slug":"/specs/locale-date-time","permalink":"/docs/specs/locale-date-time","draft":false,"unlisted":false,"editUrl":"https://github.com/nmaxcom/SmartPad/tree/main/website/docs/specs/locale-date-time.md","tags":[],"version":"current","frontMatter":{"title":"Locale Date and Time","description":"Defines locale-aware date parsing, date/time ranges, output formatting, and error normalization."},"sidebar":"docsSidebar","previous":{"title":"Ranges","permalink":"/docs/specs/ranges"},"next":{"title":"File Management","permalink":"/docs/specs/file-management"}}');var i=n(4848),a=n(8453);const l={title:"Locale Date and Time",description:"Defines locale-aware date parsing, date/time ranges, output formatting, and error normalization."},r=void 0,d={},o=[{value:"At a glance",id:"at-a-glance",level:2},{value:"Quick examples",id:"quick-examples",level:2},{value:"Happy path",id:"happy-path",level:3},{value:"Edge case",id:"edge-case",level:3},{value:"What this covers",id:"what-this-covers",level:2},{value:"Full specification",id:"full-specification",level:2},{value:"1) Range Expression Routing (must happen before date-math and solver)",id:"1-range-expression-routing-must-happen-before-date-math-and-solver",level:2},{value:"Requirement",id:"requirement",level:3},{value:"Rationale",id:"rationale",level:3},{value:"Behavior",id:"behavior",level:3},{value:"Tests (routing)",id:"tests-routing",level:3},{value:"2) Range Grammar (natural \u201cstep\u201d suffix, not named args)",id:"2-range-grammar-natural-step-suffix-not-named-args",level:2},{value:"Syntax",id:"syntax",level:3},{value:"Step value types",id:"step-value-types",level:3},{value:"Tests (grammar)",id:"tests-grammar",level:3},{value:"3) Locale-Aware Date/Datetime Input Parsing (es-ES)",id:"3-locale-aware-datedatetime-input-parsing-es-es",level:2},{value:"Requirement",id:"requirement-1",level:3},{value:"Canonical internal representation",id:"canonical-internal-representation",level:3},{value:"Accepted literals for es-ES",id:"accepted-literals-for-es-es",level:3},{value:"Date literal (es-ES)",id:"date-literal-es-es",level:4},{value:"Datetime literal (es-ES)",id:"datetime-literal-es-es",level:4},{value:"Disambiguation policy (opinionated)",id:"disambiguation-policy-opinionated",level:3},{value:"Tests (es-ES parsing)",id:"tests-es-es-parsing",level:3},{value:"Invalid locale date should be a targeted error (not solver)",id:"invalid-locale-date-should-be-a-targeted-error-not-solver",level:3},{value:"4) Date/Time/Datetime Range Semantics",id:"4-datetimedatetime-range-semantics",level:2},{value:"Step requirement (opinionated)",id:"step-requirement-opinionated",level:3},{value:"Tests (missing step)",id:"tests-missing-step",level:4},{value:"Invalid step types",id:"invalid-step-types",level:3},{value:"Inclusivity rule",id:"inclusivity-rule",level:3},{value:"Tests",id:"tests",level:4},{value:"Weekly stepping preserves weekday",id:"weekly-stepping-preserves-weekday",level:3},{value:"Test",id:"test",level:4},{value:"Monthly stepping: \u201csame day-of-month\u201d rule with anchor",id:"monthly-stepping-same-day-of-month-rule-with-anchor",level:3},{value:"Test (same day-of-month)",id:"test-same-day-of-month",level:4},{value:"Month-end stepping: clamp-to-last-day semantics (anchored)",id:"month-end-stepping-clamp-to-last-day-semantics-anchored",level:3},{value:"Test (critical)",id:"test-critical",level:4},{value:"5) Guardrails (must be a user setting)",id:"5-guardrails-must-be-a-user-setting",level:2},{value:"Setting",id:"setting",level:3},{value:"Behavior",id:"behavior-1",level:3},{value:"Tests",id:"tests-1",level:3},{value:"6) Error Normalization (no raw parser leaks for <code>..</code>)",id:"6-error-normalization-no-raw-parser-leaks-for-",level:2},{value:"Requirement",id:"requirement-2",level:3},{value:"Tests (normalization)",id:"tests-normalization",level:3},{value:"7) Output Formatting (Timezone label + compact display)",id:"7-output-formatting-timezone-label--compact-display",level:2},{value:"7.1 No \u201clocal\u201d in user-facing datetime output when locale/timezone is configured",id:"71-no-local-in-user-facing-datetime-output-when-localetimezone-is-configured",level:3},{value:"Tests (timezone label)",id:"tests-timezone-label",level:3},{value:"7.2 Compact list display: suppress repeating identical dates in datetime lists",id:"72-compact-list-display-suppress-repeating-identical-dates-in-datetime-lists",level:3},{value:"Example output format (recommended)",id:"example-output-format-recommended",level:4},{value:"Tests (compact display)",id:"tests-compact-display",level:3},{value:"7.3 \u201c=&gt;\u201d display vs assignment-only behavior (must match SmartPad core concept)",id:"73--display-vs-assignment-only-behavior-must-match-smartpad-core-concept",level:3},{value:"Tests",id:"tests-2",level:4},{value:"8) Reference Test Set (focused on the reported failures)",id:"8-reference-test-set-focused-on-the-reported-failures",level:2},{value:"Missing step",id:"missing-step",level:3},{value:"Month-end clamp",id:"month-end-clamp",level:3},{value:"Time slots (assignment line returns null; value exists)",id:"time-slots-assignment-line-returns-null-value-exists",level:3},{value:"Guardrail",id:"guardrail",level:3},{value:"Non-duration step",id:"non-duration-step",level:3},{value:"es-ES date input must not route to solver",id:"es-es-date-input-must-not-route-to-solver",level:3}];function c(e){const s={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components},{Details:n}=s;return n||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsxs)(s.p,{children:["Source: ",(0,i.jsx)(s.code,{children:"docs/Specs/Locale.spec.md"})]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"at-a-glance",children:"At a glance"}),"\n",(0,i.jsx)(s.p,{children:"Defines locale-aware date parsing, date/time ranges, output formatting, and error normalization."}),"\n",(0,i.jsx)(s.h2,{id:"quick-examples",children:"Quick examples"}),"\n",(0,i.jsx)(s.h3,{id:"happy-path",children:"Happy path"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"slots = 01-02-2023 09:00..14-02-2023 11:00 step 64 min =>\n"})}),"\n",(0,i.jsx)(s.h3,{id:"edge-case",children:"Edge case"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"period = 2026-01-01..2026-01-05 =>\u26a0\ufe0f Date/time ranges require a duration step (e.g., step 1 day)\n"})}),"\n",(0,i.jsx)(s.h2,{id:"what-this-covers",children:"What this covers"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"Range Expression Routing (must happen before date-math and solver)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"2",children:["\n",(0,i.jsx)(s.li,{children:"Range Grammar (natural \u201cstep\u201d suffix, not named args)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"3",children:["\n",(0,i.jsx)(s.li,{children:"Locale-Aware Date/Datetime Input Parsing (es-ES)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"4",children:["\n",(0,i.jsx)(s.li,{children:"Date/Time/Datetime Range Semantics"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"5",children:["\n",(0,i.jsx)(s.li,{children:"Guardrails (must be a user setting)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"6",children:["\n",(0,i.jsxs)(s.li,{children:["Error Normalization (no raw parser leaks for ",(0,i.jsx)(s.code,{children:".."}),")"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"7",children:["\n",(0,i.jsx)(s.li,{children:"Output Formatting (Timezone label + compact display)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"8",children:["\n",(0,i.jsx)(s.li,{children:"Reference Test Set (focused on the reported failures)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"full-specification",children:"Full specification"}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Open full spec: SmartPad Date/Time Ranges & Display Spec (Locale-aware, Opinionated, With Tests)"}),(0,i.jsx)(s.p,{children:"This spec resolves current failures and confusion around:"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["locale-aware date parsing (",(0,i.jsx)(s.code,{children:"es-ES"})," inputs like ",(0,i.jsx)(s.code,{children:"01-02-2023"}),")"]}),"\n",(0,i.jsx)(s.li,{children:"routing range expressions before date-math/solver parsing"}),"\n",(0,i.jsx)(s.li,{children:"correct stepping (including month-end clamping)"}),"\n",(0,i.jsx)(s.li,{children:"guardrails and user-facing error normalization"}),"\n",(0,i.jsx)(s.li,{children:"output formatting (timezone label, compact display without repeating identical dates)"}),"\n"]}),(0,i.jsxs)(s.p,{children:["SmartPad philosophy: ",(0,i.jsx)(s.strong,{children:"natural input, predictable meaning, honest errors, and readable output."}),"\nIf a user can reasonably type it, SmartPad should either understand it or give a targeted correction\u2014not a solver/equation error."]}),(0,i.jsx)(s.hr,{}),(0,i.jsx)(s.h2,{id:"1-range-expression-routing-must-happen-before-date-math-and-solver",children:"1) Range Expression Routing (must happen before date-math and solver)"}),(0,i.jsx)(s.h3,{id:"requirement",children:"Requirement"}),(0,i.jsxs)(s.p,{children:["Any expression containing ",(0,i.jsx)(s.code,{children:".."})," must be treated as a ",(0,i.jsx)(s.strong,{children:"range candidate"})," and parsed using the range parser/evaluator ",(0,i.jsx)(s.strong,{children:"before"}),":"]}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"dateMath/date-expression parsing"}),"\n",(0,i.jsx)(s.li,{children:"solver/equation parsing"}),"\n",(0,i.jsx)(s.li,{children:"generic \u201cnamed argument\u201d parsing"}),"\n"]}),(0,i.jsx)(s.h3,{id:"rationale",children:"Rationale"}),(0,i.jsx)(s.p,{children:"Range syntax is a top-level construct in SmartPad (\u201cdo the same reasoning, but plural\u201d). It should not be accidentally swallowed by other parsers."}),(0,i.jsx)(s.h3,{id:"behavior",children:"Behavior"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"If range parsing succeeds \u2192 evaluate range and return list (or set variable)."}),"\n",(0,i.jsxs)(s.li,{children:["If range parsing fails \u2192 surface a ",(0,i.jsx)(s.strong,{children:"range-specific error"}),", not a date-math or solver error."]}),"\n"]}),(0,i.jsx)(s.h3,{id:"tests-routing",children:"Tests (routing)"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"period = 2026-01-01..2026-01-05 =>\u26a0\ufe0f Date/time ranges require a duration step (e.g., step 1 day)\n"})}),(0,i.jsxs)(s.p,{children:["Must ",(0,i.jsx)(s.strong,{children:"not"})," produce:"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:'\u26a0\ufe0f Invalid date expression near "..2026-01-05"\n'})}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"slots = 01-02-2023 09:00..14-02-2023 11:00 step 64 min =>\n"})}),(0,i.jsxs)(s.p,{children:["Must ",(0,i.jsx)(s.strong,{children:"not"})," produce:"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"\u26a0\ufe0f Cannot solve: equation is not valid\n"})}),(0,i.jsx)(s.hr,{}),(0,i.jsx)(s.h2,{id:"2-range-grammar-natural-step-suffix-not-named-args",children:"2) Range Grammar (natural \u201cstep\u201d suffix, not named args)"}),(0,i.jsx)(s.h3,{id:"syntax",children:"Syntax"}),(0,i.jsx)(s.p,{children:"A range expression is:"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"<start>..<end>\n<start>..<end> step <stepValue>\n"})}),(0,i.jsxs)(s.p,{children:["Where ",(0,i.jsx)(s.code,{children:"step"})," is a ",(0,i.jsx)(s.strong,{children:"keyword suffix"})," in range grammar, not a named argument."]}),(0,i.jsx)(s.h3,{id:"step-value-types",children:"Step value types"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Numeric ranges: step must be an integer number (unitless)"}),"\n",(0,i.jsxs)(s.li,{children:["Date/Time/Datetime ranges: step must be a duration (e.g., ",(0,i.jsx)(s.code,{children:"30 min"}),", ",(0,i.jsx)(s.code,{children:"1 day"}),", ",(0,i.jsx)(s.code,{children:"2 weeks"}),", ",(0,i.jsx)(s.code,{children:"1 month"}),")"]}),"\n"]}),(0,i.jsx)(s.h3,{id:"tests-grammar",children:"Tests (grammar)"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"1..5 =>1, 2, 3, 4, 5\n0..10 step 2 =>0, 2, 4, 6, 8, 10\n09:00..11:00 step 30 min =>09:00, 09:30, 10:00, 10:30, 11:00\n2026-01-01..2026-01-05 step 1 day =>2026-01-01, 2026-01-02, 2026-01-03, 2026-01-04, 2026-01-05\n"})}),(0,i.jsx)(s.hr,{}),(0,i.jsx)(s.h2,{id:"3-locale-aware-datedatetime-input-parsing-es-es",children:"3) Locale-Aware Date/Datetime Input Parsing (es-ES)"}),(0,i.jsx)(s.h3,{id:"requirement-1",children:"Requirement"}),(0,i.jsxs)(s.p,{children:["SmartPad must accept locale-friendly date formats for input when the user has configured a locale. For ",(0,i.jsx)(s.code,{children:"es-ES"}),", accept:"]}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"DD-MM-YYYY"})}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"DD/MM/YYYY"})," (optional but recommended)"]}),"\n"]}),(0,i.jsxs)(s.p,{children:["These must be tokenized as ",(0,i.jsx)(s.code,{children:"DATE_LITERAL"}),", not as arithmetic with ",(0,i.jsx)(s.code,{children:"-"}),"."]}),(0,i.jsx)(s.h3,{id:"canonical-internal-representation",children:"Canonical internal representation"}),(0,i.jsx)(s.p,{children:"Regardless of input format, internal values are normalized to ISO:"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["date: ",(0,i.jsx)(s.code,{children:"YYYY-MM-DD"})]}),"\n",(0,i.jsxs)(s.li,{children:["time: ",(0,i.jsx)(s.code,{children:"HH:MM"})]}),"\n",(0,i.jsx)(s.li,{children:"datetime: ISO + timezone-aware instant"}),"\n"]}),(0,i.jsx)(s.h3,{id:"accepted-literals-for-es-es",children:"Accepted literals for es-ES"}),(0,i.jsx)(s.h4,{id:"date-literal-es-es",children:"Date literal (es-ES)"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"01-02-2023"})," = 1 Feb 2023"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"14/02/2023"})," = 14 Feb 2023"]}),"\n"]}),(0,i.jsx)(s.h4,{id:"datetime-literal-es-es",children:"Datetime literal (es-ES)"}),(0,i.jsxs)(s.p,{children:["A datetime literal is ",(0,i.jsx)(s.code,{children:"DATE_LITERAL"})," + space + ",(0,i.jsx)(s.code,{children:"TIME_LITERAL"}),":"]}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"01-02-2023 09:00"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"14/02/2023 11:00"})}),"\n"]}),(0,i.jsx)(s.h3,{id:"disambiguation-policy-opinionated",children:"Disambiguation policy (opinionated)"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["In ",(0,i.jsx)(s.code,{children:"es-ES"}),", ",(0,i.jsx)(s.code,{children:"DD-MM-YYYY"})," is not ambiguous \u2192 always interpret as day-month-year."]}),"\n",(0,i.jsx)(s.li,{children:"If the locale is unknown/unset, only ISO is accepted as input."}),"\n"]}),(0,i.jsx)(s.h3,{id:"tests-es-es-parsing",children:"Tests (es-ES parsing)"}),(0,i.jsxs)(s.p,{children:["Assume context locale = ",(0,i.jsx)(s.code,{children:"es-ES"}),":"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"d = 01-02-2023\nd =>2023-02-01\n"})}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"t = 09:30\nt =>09:30\n"})}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"dt = 01-02-2023 09:30\ndt =>2023-02-01 09:30 Europe/Madrid (UTC+1)\n"})}),(0,i.jsx)(s.p,{children:"Range with es-ES dates:"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"slots = 01-02-2023 09:00..14-02-2023 11:00 step 64 min =>\n"})}),(0,i.jsx)(s.p,{children:"Must not error as solver/dateMath; must produce a datetime list (guardrail permitting)."}),(0,i.jsx)(s.h3,{id:"invalid-locale-date-should-be-a-targeted-error-not-solver",children:"Invalid locale date should be a targeted error (not solver)"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:'d = 32-02-2023 =>\u26a0\ufe0f Invalid date literal "32-02-2023"\n'})}),(0,i.jsxs)(s.p,{children:["If locale is unset and user uses ",(0,i.jsx)(s.code,{children:"DD-MM-YYYY"}),":"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:'d = 01-02-2023 =>\u26a0\ufe0f Unsupported date format "01-02-2023". Use ISO "2023-02-01".\n'})}),(0,i.jsx)(s.hr,{}),(0,i.jsx)(s.h2,{id:"4-datetimedatetime-range-semantics",children:"4) Date/Time/Datetime Range Semantics"}),(0,i.jsx)(s.h3,{id:"step-requirement-opinionated",children:"Step requirement (opinionated)"}),(0,i.jsxs)(s.p,{children:["For ",(0,i.jsx)(s.code,{children:"date"}),", ",(0,i.jsx)(s.code,{children:"time"}),", and ",(0,i.jsx)(s.code,{children:"datetime"})," ranges: ",(0,i.jsx)(s.strong,{children:"step is required"}),"."]}),(0,i.jsx)(s.p,{children:"This avoids \u201csilent assumptions\u201d and keeps user intent explicit."}),(0,i.jsx)(s.h4,{id:"tests-missing-step",children:"Tests (missing step)"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"period = 2026-01-01..2026-01-05 =>\u26a0\ufe0f Date/time ranges require a duration step (e.g., step 1 day)\nslots = 09:00..11:00 =>\u26a0\ufe0f Date/time ranges require a duration step (e.g., step 30 min)\n"})}),(0,i.jsx)(s.h3,{id:"invalid-step-types",children:"Invalid step types"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"period = 2026-01-01..2026-01-05 step 2 =>\u26a0\ufe0f Invalid range step: expected duration, got number\nxs = 1..10 step 1 day =>\u26a0\ufe0f Invalid range step: expected integer, got duration\n"})}),(0,i.jsx)(s.h3,{id:"inclusivity-rule",children:"Inclusivity rule"}),(0,i.jsx)(s.p,{children:"A range includes the end value only if it aligns exactly on the step sequence."}),(0,i.jsx)(s.h4,{id:"tests",children:"Tests"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"09:00..10:00 step 30 min =>09:00, 09:30, 10:00\n09:00..10:00 step 40 min =>09:00, 09:40\n"})}),(0,i.jsx)(s.h3,{id:"weekly-stepping-preserves-weekday",children:"Weekly stepping preserves weekday"}),(0,i.jsx)(s.h4,{id:"test",children:"Test"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"2026-01-01..2026-02-01 step 1 week =>2026-01-01, 2026-01-08, 2026-01-15, 2026-01-22, 2026-01-29\n"})}),(0,i.jsx)(s.h3,{id:"monthly-stepping-same-day-of-month-rule-with-anchor",children:"Monthly stepping: \u201csame day-of-month\u201d rule with anchor"}),(0,i.jsxs)(s.p,{children:["Monthly stepping must use the ",(0,i.jsx)(s.strong,{children:"original start day-of-month"})," as the anchor, not the previously emitted date\u2019s day."]}),(0,i.jsx)(s.h4,{id:"test-same-day-of-month",children:"Test (same day-of-month)"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"2026-01-15..2026-05-15 step 1 month =>2026-01-15, 2026-02-15, 2026-03-15, 2026-04-15, 2026-05-15\n"})}),(0,i.jsx)(s.h3,{id:"month-end-stepping-clamp-to-last-day-semantics-anchored",children:"Month-end stepping: clamp-to-last-day semantics (anchored)"}),(0,i.jsxs)(s.p,{children:["If the anchor day doesn\u2019t exist in a target month, clamp to the last day of that month ",(0,i.jsx)(s.strong,{children:"but keep the original anchor for subsequent months"}),"."]}),(0,i.jsx)(s.h4,{id:"test-critical",children:"Test (critical)"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"2026-01-31..2026-05-31 step 1 month =>2026-01-31, 2026-02-28, 2026-03-31, 2026-04-30, 2026-05-31\n"})}),(0,i.jsx)(s.hr,{}),(0,i.jsx)(s.h2,{id:"5-guardrails-must-be-a-user-setting",children:"5) Guardrails (must be a user setting)"}),(0,i.jsx)(s.h3,{id:"setting",children:"Setting"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Name (suggested): ",(0,i.jsx)(s.code,{children:"max generated list size"})]}),"\n",(0,i.jsxs)(s.li,{children:["Default (suggested): ",(0,i.jsx)(s.code,{children:"10000"})]}),"\n",(0,i.jsx)(s.li,{children:"Applies to all generated ranges (numeric/date/time/datetime)"}),"\n"]}),(0,i.jsx)(s.h3,{id:"behavior-1",children:"Behavior"}),(0,i.jsx)(s.p,{children:"After parsing and validating step, compute number of elements.\nIf exceeds setting, error:"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"\u26a0\ufe0f Range too large (<n> elements; max <max>)\n"})}),(0,i.jsx)(s.h3,{id:"tests-1",children:"Tests"}),(0,i.jsxs)(s.p,{children:["Assume setting ",(0,i.jsx)(s.code,{children:"max generated list size = 500"}),":"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"slots = 2026-01-01 09:00..2026-01-01 23:59 step 1 min =>\n\u26a0\ufe0f Range too large (900 elements; max 500)\n"})}),(0,i.jsx)(s.p,{children:"Guardrail must not be shadowed by date-math parser errors."}),(0,i.jsx)(s.hr,{}),(0,i.jsxs)(s.h2,{id:"6-error-normalization-no-raw-parser-leaks-for-",children:["6) Error Normalization (no raw parser leaks for ",(0,i.jsx)(s.code,{children:".."}),")"]}),(0,i.jsx)(s.h3,{id:"requirement-2",children:"Requirement"}),(0,i.jsxs)(s.p,{children:["If an input contains ",(0,i.jsx)(s.code,{children:".."}),", SmartPad must never surface:"]}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"raw dateMath \u201cInvalid date expression near \u2026\u201d"}),"\n",(0,i.jsx)(s.li,{children:"raw parser \u201cInvalid named argument \u2026\u201d"}),"\n",(0,i.jsx)(s.li,{children:"solver \u201cCannot solve \u2026\u201d"}),"\n",(0,i.jsx)(s.li,{children:"any unrelated internal parse errors"}),"\n"]}),(0,i.jsx)(s.p,{children:"Instead, errors must be normalized to one of:"}),(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"Missing duration step (date/time/datetime):"}),"\n"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"\u26a0\ufe0f Date/time ranges require a duration step (e.g., step 1 day)\n"})}),(0,i.jsxs)(s.ol,{start:"2",children:["\n",(0,i.jsx)(s.li,{children:"Invalid step type:"}),"\n"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"\u26a0\ufe0f Invalid range step: expected <expected>, got <got>\n"})}),(0,i.jsxs)(s.ol,{start:"3",children:["\n",(0,i.jsx)(s.li,{children:"Guardrail:"}),"\n"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"\u26a0\ufe0f Range too large (<n> elements; max <max>)\n"})}),(0,i.jsxs)(s.ol,{start:"4",children:["\n",(0,i.jsx)(s.li,{children:"Generic malformed range:"}),"\n"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:'\u26a0\ufe0f Invalid range expression near "<snippet>"\n'})}),(0,i.jsx)(s.h3,{id:"tests-normalization",children:"Tests (normalization)"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:'2026-01-01....2026-01-05 =>\u26a0\ufe0f Invalid range expression near "2026-01-01....2026-01-05"\n2026-01-01.. step 1 day =>\u26a0\ufe0f Invalid range expression near "2026-01-01.. step 1 day"\n..2026-01-05 step 1 day =>\u26a0\ufe0f Invalid range expression near "..2026-01-05 step 1 day"\n'})}),(0,i.jsx)(s.hr,{}),(0,i.jsx)(s.h2,{id:"7-output-formatting-timezone-label--compact-display",children:"7) Output Formatting (Timezone label + compact display)"}),(0,i.jsx)(s.h3,{id:"71-no-local-in-user-facing-datetime-output-when-localetimezone-is-configured",children:"7.1 No \u201clocal\u201d in user-facing datetime output when locale/timezone is configured"}),(0,i.jsxs)(s.p,{children:["If the user has configured locale/timezone (e.g., ",(0,i.jsx)(s.code,{children:"es-ES"}),", ",(0,i.jsx)(s.code,{children:"Europe/Madrid"}),"), never print \u201clocal\u201d.\nUse one of:"]}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"Europe/Madrid (UTC+1)"})," (recommended)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"UTC+1"})," (acceptable minimal)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"Europe/Madrid"})," (acceptable)"]}),"\n"]}),(0,i.jsx)(s.h3,{id:"tests-timezone-label",children:"Tests (timezone label)"}),(0,i.jsxs)(s.p,{children:["Assume timezone ",(0,i.jsx)(s.code,{children:"Europe/Madrid"}),", date in winter:"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"dt = 2026-01-01 09:00\ndt =>2026-01-01 09:00 Europe/Madrid (UTC+1)\n"})}),(0,i.jsx)(s.h3,{id:"72-compact-list-display-suppress-repeating-identical-dates-in-datetime-lists",children:"7.2 Compact list display: suppress repeating identical dates in datetime lists"}),(0,i.jsx)(s.p,{children:"When displaying a list of datetimes where multiple consecutive items share the same date, print the date once and then only times (with timezone) for subsequent items until the date changes."}),(0,i.jsx)(s.h4,{id:"example-output-format-recommended",children:"Example output format (recommended)"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"slots =>2026-01-01: 09:00, 09:18, 09:36, 09:54, 10:12, 10:30, 10:48 Europe/Madrid (UTC+1)\n"})}),(0,i.jsx)(s.p,{children:"If the list spans multiple dates:"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"slots =>2026-01-01: 23:30, 23:48 Europe/Madrid (UTC+1); 2026-01-02: 00:06, 00:24 Europe/Madrid (UTC+1)\n"})}),(0,i.jsx)(s.h3,{id:"tests-compact-display",children:"Tests (compact display)"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"slots = 2026-01-01 09:00..2026-01-01 11:00 step 18 min =>\nslots =>2026-01-01: 09:00, 09:18, 09:36, 09:54, 10:12, 10:30, 10:48 Europe/Madrid (UTC+1)\n"})}),(0,i.jsx)(s.p,{children:"Crossing midnight:"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"slots = 2026-01-01 23:30..2026-01-02 00:30 step 18 min =>\nslots =>2026-01-01: 23:30, 23:48 Europe/Madrid (UTC+1); 2026-01-02: 00:06, 00:24 Europe/Madrid (UTC+1)\n"})}),(0,i.jsx)(s.h3,{id:"73--display-vs-assignment-only-behavior-must-match-smartpad-core-concept",children:"7.3 \u201c=>\u201d display vs assignment-only behavior (must match SmartPad core concept)"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Lines without ",(0,i.jsx)(s.code,{children:"=>"})," assign silently (return null)"]}),"\n",(0,i.jsxs)(s.li,{children:["Lines with ",(0,i.jsx)(s.code,{children:"=>"})," produce display output"]}),"\n"]}),(0,i.jsx)(s.h4,{id:"tests-2",children:"Tests"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"slots = 2026-01-01 09:00..2026-01-01 11:00 step 30 min\n=> (no output; evaluateLine returns null; variable is set)\n\nslots =>2026-01-01: 09:00, 09:30, 10:00, 10:30, 11:00 Europe/Madrid (UTC+1)\n"})}),(0,i.jsx)(s.hr,{}),(0,i.jsx)(s.h2,{id:"8-reference-test-set-focused-on-the-reported-failures",children:"8) Reference Test Set (focused on the reported failures)"}),(0,i.jsxs)(s.p,{children:["These map to your failing ",(0,i.jsx)(s.code,{children:"dateRange.test.ts"})," cases:"]}),(0,i.jsx)(s.h3,{id:"missing-step",children:"Missing step"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"period = 2026-01-01..2026-01-05 =>\u26a0\ufe0f Date/time ranges require a duration step (e.g., step 1 day)\n"})}),(0,i.jsx)(s.h3,{id:"month-end-clamp",children:"Month-end clamp"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"period = 2026-01-31..2026-05-31 step 1 month\nperiod =>2026-01-31, 2026-02-28, 2026-03-31, 2026-04-30, 2026-05-31\n"})}),(0,i.jsx)(s.h3,{id:"time-slots-assignment-line-returns-null-value-exists",children:"Time slots (assignment line returns null; value exists)"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"slots = 2026-01-01 09:00..2026-01-01 11:00 step 30 min\n"})}),(0,i.jsx)(s.p,{children:"Then:"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"slots =>2026-01-01: 09:00, 09:30, 10:00, 10:30, 11:00 Europe/Madrid (UTC+1)\n"})}),(0,i.jsx)(s.h3,{id:"guardrail",children:"Guardrail"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"slots = 2026-01-01 09:00..2026-01-01 23:59 step 1 min =>\u26a0\ufe0f Range too large (900 elements; max 500)\n"})}),(0,i.jsx)(s.h3,{id:"non-duration-step",children:"Non-duration step"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"period = 2026-01-01..2026-01-05 step 2 =>\u26a0\ufe0f Invalid range step: expected duration, got number\n"})}),(0,i.jsx)(s.h3,{id:"es-es-date-input-must-not-route-to-solver",children:"es-ES date input must not route to solver"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-text",children:"slots = 01-02-2023 09:00..14-02-2023 11:00 step 64 min =>\n"})}),(0,i.jsx)(s.p,{children:"Must produce either:"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"the computed list (if within guardrail)\nor:"}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"\u26a0\ufe0f Range too large (...)"}),"\nbut never a solver error."]}),"\n"]})]})]})}function h(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453(e,s,n){n.d(s,{R:()=>l,x:()=>r});var t=n(6540);const i={},a=t.createContext(i);function l(e){const s=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(a.Provider,{value:s},e.children)}}}]);