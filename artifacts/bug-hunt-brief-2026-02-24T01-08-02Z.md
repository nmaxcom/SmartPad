# SmartPad Syntax Bug Hunt Brief

- Run timestamp (UTC): 2026-02-24T01-08-02Z
- Branch: `codex/bughunt-syntax-20260224-01`
- Evidence sweep: `artifacts/bug-hunt-sweep-2026-02-24T01-07-28-923Z.md`
- Unit baseline: `tests/unit/list.test.ts`, `tests/unit/dateRange.test.ts`, `tests/unit/functions.test.ts`, `tests/unit/solve.test.ts`, `tests/unit/unitAliasEdgeCases.test.ts` (all passing)

## Section A: High-priority findings

### BH-001
- Classification: BUG
- Severity: P1
- Confidence: 0.95
- Minimal repro: `1,,2=>` (also `1, ,2=>`)
- Expected: explicit parse error for empty list element (for example `Cannot create list: empty value`) per list validation behavior in `docs/Specs/Lists.spec.md`.
- Actual: no rendered result (`resultType=none`), silent failure.
- Impact: users get no feedback and cannot self-correct malformed list input.
- Recommendation: force explicit error render on empty list elements in explicit `=>` path.
- Suggested regression test: `tests/unit/listEmptyElementExplicitError.test.ts`

### BH-002
- Classification: BUG
- Severity: P1
- Confidence: 0.98
- Minimal repro: `1,2 to =>`
- Expected: invalid conversion target error; `to` should only bind when RHS is a valid unit target.
- Actual: `1 to, 2 tos` (nonsensical pluralized pseudo-unit output).
- Impact: incorrect output can be mistaken for valid computation.
- Recommendation: reject empty target after `to|in` before list annotation path.
- Suggested regression test: `tests/unit/listMissingConversionTarget.test.ts`

### BH-003
- Classification: BUG
- Severity: P0
- Confidence: 0.92
- Minimal repro: `speed=9m/s`, then `speed to m/(0 s)=>`
- Expected: hard error for zero denominator target.
- Actual: `0 m/(0 s)`.
- Impact: mathematically invalid result accepted as valid conversion.
- Recommendation: disallow zero-valued denominator groups in conversion targets.
- Suggested regression test: `tests/unit/unitConversionZeroDenominatorTarget.test.ts`

### BH-004
- Classification: BUG
- Severity: P0
- Confidence: 0.90
- Minimal repro: `distance=v*time`, `distance=10m`, `time=0s`, `v=>`
- Expected: solve error for division by zero / unsatisfied domain.
- Actual: `10 m / 0 s` returned as math result.
- Impact: unsafe symbolic/numeric outputs can propagate invalid physics/business numbers.
- Recommendation: add zero-denominator domain checks in solve simplification and numeric substitution.
- Suggested regression test: `tests/unit/solveDivisionByZeroGuard.test.ts`

### BH-005
- Classification: BUG
- Severity: P1
- Confidence: 0.88
- Minimal repro: `costs=10,20,30 to $`, then `sum(costs where > $15)=>`
- Expected: filtered list then aggregation (`$50`).
- Actual: `⚠️ where() expects a list, got number`.
- Impact: documented list + aggregator composition fails in realistic workflows.
- Recommendation: ensure `where` subexpressions preserve list type when nested under aggregators.
- Suggested regression test: `tests/unit/listWhereInsideAggregator.test.ts`

### BH-006
- Classification: BUG
- Severity: P1
- Confidence: 0.87
- Minimal repro: `costs=10,20,30 to $`, `tax=8%`, then `tax on sum(costs)=>`
- Expected: percentage-on over computed scalar (`$64.8`).
- Actual: literal text echoed as math result: `tax on sum(costs)`.
- Impact: appears evaluated but is not; high trust risk.
- Recommendation: prevent unresolved phrase fallthrough from rendering as successful math result.
- Suggested regression test: `tests/unit/percentageOnNestedAggregator.test.ts`

### BH-007
- Classification: BUG
- Severity: P1
- Confidence: 0.84
- Minimal repro: `r=2m,4m,6m`, `f(x)=x*2`, then `f(sum(r to cm))=>`
- Expected: nested expression evaluates and binds to `x`.
- Actual: `⚠️ Error in f: Missing argument: x`.
- Impact: nested function composition breaks for unit/list pipelines.
- Recommendation: fix argument binding when call arg contains conversion+aggregation expression.
- Suggested regression test: `tests/unit/functionNestedConversionAggregationArg.test.ts`

## Section B: Spec divergences for product decision

### BH-008
- Classification: SPEC_DIVERGENCE
- Severity: P1
- Confidence: 0.90
- Minimal repro: `xs=1,2,3`, then `xs where >== 2=>`
- Expected: syntax/operator error.
- Actual: accepted and behaves like `>=`.
- Impact: typos silently produce plausible but potentially wrong results.
- Recommendation: either formalize permissive aliasing in spec or reject malformed comparator tokens.
- Suggested regression test: `tests/unit/listWhereMalformedComparator.test.ts`

### BH-009
- Classification: SPEC_DIVERGENCE
- Severity: P1
- Confidence: 0.93
- Minimal repro: `sum()=>` and `avg()=>`
- Expected: argument/list contract error per `docs/Specs/Lists.spec.md` aggregator rules.
- Actual: both return `0`.
- Impact: hides missing-input mistakes as valid output.
- Recommendation: enforce required list argument count for aggregators.
- Suggested regression test: `tests/unit/aggregatorZeroArgContract.test.ts`

### BH-010
- Classification: SPEC_DIVERGENCE
- Severity: P2
- Confidence: 0.89
- Minimal repro: `2024-02-30=>`
- Expected: normalized date-literal error per locale/date spec (`Invalid date literal ...`), no raw parser leak.
- Actual: `⚠️ Expression parse error: Invalid date/time value`.
- Impact: lower-quality guidance and inconsistent UX error surface.
- Recommendation: normalize ISO-invalid dates through same user-facing date error channel.
- Suggested regression test: `tests/unit/dateLiteralErrorNormalization.test.ts`

### BH-011
- Classification: SPEC_DIVERGENCE
- Severity: P2
- Confidence: 0.82
- Minimal repro: `2026-01-01..2026-01-03 step 25h=>`
- Expected: valid date range stepping by duration literal (compact unit token).
- Actual: `⚠️ Date/time ranges require a duration step...` (even though step exists).
- Impact: valid compact duration input rejected with misleading message.
- Recommendation: accept compact duration tokens (`25h`, `30min`) in range-step parser or explicitly de-spec.
- Suggested regression test: `tests/unit/dateRangeCompactDurationStep.test.ts`

### BH-012
- Classification: SPEC_DIVERGENCE
- Severity: P2
- Confidence: 0.80
- Minimal repro: `2026-01-05..2026-01-01 step 1 day=>` passes; `... step -1 day=>` errors.
- Expected: consistent step-direction rule (either sign must match direction, or signs normalized consistently).
- Actual: positive step accepted for descending date/time ranges while negative step is rejected.
- Impact: inconsistent mental model vs numeric ranges; onboarding friction.
- Recommendation: pick one rule and enforce/document uniformly for numeric/date/time ranges.
- Suggested regression test: `tests/unit/dateRangeStepDirectionPolicy.test.ts`

## Section C: Emergent feature opportunities

### BH-013
- Classification: EMERGENT_FEATURE
- Severity: P3
- Confidence: 0.78
- Minimal repro: `round(PI,)=>`, `g(3,)=>`
- Expected: currently unspecified.
- Actual: trailing commas are tolerated and produce successful evaluation.
- Impact: may improve editing ergonomics and reduce syntax friction.
- Recommendation: decide whether to officially support trailing commas in function calls; document if accepted.
- Suggested regression test: `tests/unit/functionTrailingCommaPolicy.test.ts`

### BH-014
- Classification: EMERGENT_FEATURE
- Severity: P3
- Confidence: 0.75
- Minimal repro: `1...5=>`
- Expected: currently unspecified (likely typo).
- Actual: interpreted as `1..5` and returns range.
- Impact: typo-tolerance can help speed, but may also hide mistakes.
- Recommendation: choose policy: explicit lint warning, strict error, or documented tolerant parse.
- Suggested regression test: `tests/unit/rangeTripleDotPolicy.test.ts`

## Section D: Proposed regression test additions

1. `tests/unit/listEmptyElementExplicitError.test.ts`
2. `tests/unit/listMissingConversionTarget.test.ts`
3. `tests/unit/unitConversionZeroDenominatorTarget.test.ts`
4. `tests/unit/solveDivisionByZeroGuard.test.ts`
5. `tests/unit/listWhereInsideAggregator.test.ts`
6. `tests/unit/percentageOnNestedAggregator.test.ts`
7. `tests/unit/functionNestedConversionAggregationArg.test.ts`
8. `tests/unit/listWhereMalformedComparator.test.ts`
9. `tests/unit/aggregatorZeroArgContract.test.ts`
10. `tests/unit/dateLiteralErrorNormalization.test.ts`
11. `tests/unit/dateRangeCompactDurationStep.test.ts`
12. `tests/unit/dateRangeStepDirectionPolicy.test.ts`
13. `tests/unit/functionTrailingCommaPolicy.test.ts`
14. `tests/unit/rangeTripleDotPolicy.test.ts`

## Section E: Explored and stable in this pass

- Existing temporary edge sweep remains green: `node scripts/run-temporary-edge-tests.js` => 50/50 pass.
- Core targeted unit suites remain green (104 assertions across list/date/functions/solve/alias suites).
- Stable in this run:
  - Numeric range step-direction validation (`1..5 step -2`, `5..1 step 2`) behaves as expected.
  - Currency/unit rate conversions (`1MB/s <-> Mbit/s`, alias scaling `ksec`) behave consistently.
  - Named-argument validation (`unknown arg` rejection) remains correct.
  - Invalid slash-date literals (`13/13/2024`) already map to targeted date-literal errors.

